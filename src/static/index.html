<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>Tongues Arbitrage Monitor</title>
    <link rel="stylesheet" href="/static/style.css"/>
</head>

<body>

<h1>Real-time Arbitrage Monitor</h1>
<div id="container"></div>

<script>
async function loadData() {
    const res = await fetch("/api/monitor");
    const data = await res.json();

    const root = document.getElementById("container");
    root.innerHTML = "";

    (data.symbols || []).forEach(sym => {
        const box = document.createElement("div");
        box.className = "box";

        box.innerHTML += `<h2>${sym.symbol}</h2>`;

        if (sym.error) {
            box.innerHTML += `<p style="color:red;">Worker error: ${sym.error}</p>`;
            root.appendChild(box);
            return;
        }

        if (!sym.signals || sym.signals.length === 0) {
            box.innerHTML += `<p>No arbitrage signals.</p>`;
        } else {
            const ul = sym.signals.map(s =>
                `<li><b>${s.signal}</b> @ Strike ${s.strike} (r=${s.implied_r.toFixed(4)})</li>`
            ).join("");
            box.innerHTML += `<ul>${ul}</ul>`;
        }

        root.appendChild(box);
    });
}

loadData();
setInterval(loadData, 5000);
</script>

</body>
</html>
